function generateArticleSlug(e){return e?e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""):""}function getArticleSlugFromUrl(){const e=window.location.pathname,t=e.match(/\/([^\/]+)\.html$/);if(t){const e=t[1];if(!["news","index","courses","about","contact"].includes(e))return e}const n=e.match(/news-article-(\d+)\.html/);return n?parseInt(n[1],10):null}function loadArticle(e){if("undefined"==typeof newsArticles)return console.error("newsArticles not found"),null;let t=newsArticles.find((t=>t.slug===e));return t||"number"!=typeof e||(t=newsArticles.find((t=>t.id===e))),t||"string"!=typeof e||(t=newsArticles.find((t=>generateArticleSlug(t.title)===e||t.slug===e))),t||null}function renderArticle(e){if(!e)return;const t=document.getElementById("article-title-meta");t&&(t.textContent=`${e.title} - Continuity Training Academy`);const n=document.getElementById("article-category-breadcrumb");n&&(n.textContent=e.category);const o=document.getElementById("article-category");o&&(o.textContent=e.category);const r=document.getElementById("article-title");r&&(r.textContent=e.title);const c=document.getElementById("article-excerpt");c&&(c.textContent=e.excerpt);const i=document.getElementById("article-date");i&&(i.textContent=formatDate(e.date,"short"),i.setAttribute("datetime",e.date));const a=document.getElementById("article-read-time");a&&(a.textContent=e.readTime);const l=document.getElementById("article-featured-image");l&&(l.src=e.image,l.alt=e.title),updateMetaTags(e)}function updateMetaTags(e){const t=document.querySelector('meta[property="og:title"]');t&&t.setAttribute("content",`${e.title} - Continuity Training Academy`);const n=document.querySelector('meta[property="og:description"]');n&&n.setAttribute("content",e.excerpt);const o=document.querySelector('meta[property="og:image"]');o&&o.setAttribute("content",`https://continuitytrainingacademy.co.uk/${e.image}`);const r=document.querySelector('meta[property="og:url"]');r&&r.setAttribute("content",window.location.href);const c=document.querySelector('meta[name="twitter:title"]');c&&c.setAttribute("content",e.title);const i=document.querySelector('meta[name="twitter:description"]');i&&i.setAttribute("content",e.excerpt);const a=document.querySelector('meta[name="twitter:image"]');a&&a.setAttribute("content",`https://continuitytrainingacademy.co.uk/${e.image}`)}function renderRelatedArticles(e){if("undefined"==typeof newsArticles)return;const t=newsArticles.find((t=>t.id===e));if(!t)return;let n=newsArticles.filter((n=>n.id!==e&&n.category===t.category)).slice(0,4);if(0===n.length){const e=document.getElementById("related-articles-grid");return void(e&&(e.innerHTML="<p>No related articles found.</p>"))}const o=document.getElementById("related-articles-grid");o&&(o.innerHTML=n.map((e=>`\n    <article class="news-article-card">\n      <div class="news-article-image-wrapper">\n        <img\n          src="${e.image}"\n          alt="${e.title}"\n          class="news-article-image"\n        />\n      </div>\n      <div class="news-article-content">\n        <div class="news-article-meta">\n          <span class="news-category-badge">${e.category}</span>\n          <span class="news-article-date">${formatDate(e.date,"short")}</span>\n          <span class="news-read-time">${e.readTime}</span>\n        </div>\n        <h3 class="news-article-title">${e.title}</h3>\n        <p class="news-article-excerpt">${e.excerpt}</p>\n        <a href="${e.slug?e.slug+".html":"news-article-"+e.id+".html"}" class="news-article-link">\n          Read More\n          ${getArrowRightIcon("news-arrow-icon-small")}\n        </a>\n      </div>\n    </article>\n  `)).join(""))}function setupRelatedArticlesNav(){const e=document.getElementById("related-prev"),t=document.getElementById("related-next"),n=document.getElementById("related-articles-grid");e&&t&&n&&(e.addEventListener("click",(()=>{n.scrollBy({left:-300,behavior:"smooth"})})),t.addEventListener("click",(()=>{n.scrollBy({left:300,behavior:"smooth"})})))}function setupShareButtons(e){if(!e)return;const t=window.location.href,n=e.title,o=e.excerpt,r=document.getElementById("news-article-save-btn");r&&r.addEventListener("click",(()=>{navigator.share?navigator.share({title:n,text:o,url:t}).catch((e=>{console.log("Error sharing:",e),copyToClipboard(t,r)})):copyToClipboard(t,r)}));const c=document.getElementById("news-article-facebook-btn");c&&c.addEventListener("click",(()=>{const e=`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(t)}`;window.open(e,"facebook-share","width=600,height=400,menubar=no,toolbar=no,resizable=yes,scrollbars=yes")}));const i=document.getElementById("news-article-linkedin-btn");i&&i.addEventListener("click",(()=>{const e=`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(t)}`;window.open(e,"linkedin-share","width=600,height=400,menubar=no,toolbar=no,resizable=yes,scrollbars=yes")}));const a=document.getElementById("news-article-twitter-btn");a&&a.addEventListener("click",(()=>{const e=`https://twitter.com/intent/tweet?url=${encodeURIComponent(t)}&text=${encodeURIComponent(n)}`;window.open(e,"twitter-share","width=600,height=400,menubar=no,toolbar=no,resizable=yes,scrollbars=yes")}))}function copyToClipboard(e,t){navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then((()=>{showCopyFeedback(t)})).catch((n=>{console.error("Failed to copy:",n),fallbackCopyToClipboard(e,t)})):fallbackCopyToClipboard(e,t)}function fallbackCopyToClipboard(e,t){const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.left="-999999px",n.style.top="-999999px",document.body.appendChild(n),n.focus(),n.select();try{document.execCommand("copy"),showCopyFeedback(t)}catch(t){console.error("Fallback copy failed:",t),alert("Unable to copy link. Please copy manually: "+e)}document.body.removeChild(n)}function showCopyFeedback(e){const t=e.querySelector("i"),n=t.className;t.className="fas fa-check",e.setAttribute("aria-label","Link copied!"),e.classList.add("copied"),setTimeout((()=>{t.className=n,e.setAttribute("aria-label","Save article"),e.classList.remove("copied")}),2e3)}function initializeArticle(){const e=getArticleSlugFromUrl();if(!e)return console.error("No article slug or ID found in URL"),void(window.location.href="news.html");const t=loadArticle(e);t?(renderArticle(t),renderRelatedArticles(t.id),setupShareButtons(t)):(console.error("Article not found:",e),window.location.href="news.html"),setupRelatedArticlesNav(),initTableOfContents()}function initTableOfContents(){const e=document.getElementById("article-body");if(!e)return;const t=e.querySelectorAll(".entry-content h2");if(t.length<2)return;const n=document.getElementById("article-toc");if(!n)return;n.innerHTML="",t.forEach(((e,t)=>{let o=e.id;o||(o=e.textContent.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),document.getElementById(o)&&(o=`${o}-${t}`),e.id=o);const r=document.createElement("li"),c=document.createElement("a");c.href=`#${o}`,c.textContent=e.textContent.trim(),c.addEventListener("click",(e=>{e.preventDefault();const t=document.getElementById(o);if(t){const e=120,o=t.getBoundingClientRect().top+window.pageYOffset-e;window.scrollTo({top:o,behavior:"smooth"}),n.querySelectorAll("a").forEach((e=>{e.classList.remove("active")})),c.classList.add("active")}})),r.appendChild(c),n.appendChild(r)}));let o=!1;const r=()=>{o||(window.requestAnimationFrame((()=>{const e=window.scrollY+200;let r=null;if(t.forEach((t=>{const n=t.getBoundingClientRect().top+window.pageYOffset,o=n+t.offsetHeight;e>=n-50&&e<o&&(r=t)})),!r&&t.length>0){const n=t[t.length-1],o=n.getBoundingClientRect().top+window.pageYOffset+n.offsetHeight;e>=o-100&&(r=n)}if(n.querySelectorAll("a").forEach((e=>{e.classList.remove("active")})),r){const e=n.querySelector(`a[href="#${r.id}"]`);e&&e.classList.add("active")}o=!1})),o=!0)};window.addEventListener("scroll",r,{passive:!0}),r()}document.addEventListener("DOMContentLoaded",(()=>{"undefined"==typeof newsArticles?setTimeout((()=>{initializeArticle()}),100):initializeArticle()}));